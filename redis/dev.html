<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>spring-boot redis cache | HTDP1</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="htdp1 github pages">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.3a5cdffa.css" as="style"><link rel="preload" href="/assets/js/app.aa526b38.js" as="script"><link rel="preload" href="/assets/js/2.a05a4124.js" as="script"><link rel="preload" href="/assets/js/17.b22e9f4c.js" as="script"><link rel="prefetch" href="/assets/js/10.b2f5c771.js"><link rel="prefetch" href="/assets/js/11.eacf68d3.js"><link rel="prefetch" href="/assets/js/12.cdf80038.js"><link rel="prefetch" href="/assets/js/13.cb9fe296.js"><link rel="prefetch" href="/assets/js/14.c78f591d.js"><link rel="prefetch" href="/assets/js/15.3b4eecbf.js"><link rel="prefetch" href="/assets/js/16.0dc56dd0.js"><link rel="prefetch" href="/assets/js/18.3bfa19ef.js"><link rel="prefetch" href="/assets/js/19.2d57552a.js"><link rel="prefetch" href="/assets/js/3.82e9417b.js"><link rel="prefetch" href="/assets/js/4.0fb88337.js"><link rel="prefetch" href="/assets/js/5.fb24cf2a.js"><link rel="prefetch" href="/assets/js/6.cea4fcf3.js"><link rel="prefetch" href="/assets/js/7.f2e1079f.js"><link rel="prefetch" href="/assets/js/8.b8b9bc3c.js"><link rel="prefetch" href="/assets/js/9.13ca00e3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3a5cdffa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="global-layout"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">HTDP1</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/aws/" class="nav-link">
  AWS
</a></div><div class="nav-item"><a href="/redis/" class="nav-link router-link-active">
  Redis
</a></div><div class="nav-item"><a href="/sp1/" class="nav-link">
  Sprint#1
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/aws/" class="nav-link">
  AWS
</a></div><div class="nav-item"><a href="/redis/" class="nav-link router-link-active">
  Redis
</a></div><div class="nav-item"><a href="/sp1/" class="nav-link">
  Sprint#1
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Redis</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/redis/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/redis/dev.html" aria-current="page" class="active sidebar-link">spring-boot redis cache</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/redis/dev.html#개발환경-준비" class="sidebar-link">개발환경 준비</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/redis/dev.html#redis-설치" class="sidebar-link">redis 설치</a></li><li class="sidebar-sub-header"><a href="/redis/dev.html#mariadb-설치" class="sidebar-link">mariadb 설치</a></li><li class="sidebar-sub-header"><a href="/redis/dev.html#vs-code-개발환경" class="sidebar-link">vs code 개발환경</a></li></ul></li><li class="sidebar-sub-header"><a href="/redis/dev.html#spring-boot-data-rest-를-이용한-db-table-crud-개발" class="sidebar-link">spring-boot-data-rest 를 이용한 DB table CRUD 개발</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/redis/dev.html#maven-dependency-추가" class="sidebar-link">maven dependency 추가</a></li><li class="sidebar-sub-header"><a href="/redis/dev.html#application-yml-설정" class="sidebar-link">application.yml 설정</a></li><li class="sidebar-sub-header"><a href="/redis/dev.html#model-class-생성" class="sidebar-link">model class 생성</a></li><li class="sidebar-sub-header"><a href="/redis/dev.html#repository-class-생성" class="sidebar-link">repository class 생성</a></li><li class="sidebar-sub-header"><a href="/redis/dev.html#spring-boot-실행-후-api-확인" class="sidebar-link">spring-boot 실행 후 API 확인</a></li></ul></li><li class="sidebar-sub-header"><a href="/redis/dev.html#spring-boot-redis-적용-개발" class="sidebar-link">spring-boot redis 적용 개발</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/redis/dev.html#maven-dependency-추가-2" class="sidebar-link">maven dependency 추가</a></li><li class="sidebar-sub-header"><a href="/redis/dev.html#application-yml-redis-설정" class="sidebar-link">application.yml redis 설정</a></li><li class="sidebar-sub-header"><a href="/redis/dev.html#redis-configuration-class-생성" class="sidebar-link">redis configuration class 생성</a></li><li class="sidebar-sub-header"><a href="/redis/dev.html#repository-class-에-cache-적용" class="sidebar-link">repository class 에 cache 적용</a></li><li class="sidebar-sub-header"><a href="/redis/dev.html#redis-에서-데이터-확인" class="sidebar-link">redis 에서 데이터 확인</a></li></ul></li></ul></li><li><a href="/redis/perftest.html" class="sidebar-link">Redis 성능 측정</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spring-boot-redis-cache"><a href="#spring-boot-redis-cache" class="header-anchor">#</a> spring-boot redis cache</h1> <p>spring-boot-data-rest, spring-boot-data-jpa 를 이용하여<br>
DB table 에 대한 CRUD 기능을 개발하고,<br>
spring-boot-starter-data-redis 를 사용하여 redis cache 를 적용하는 방법을 설명한다.</p> <ul><li>Sample App. Arch. (dept-spring)</li></ul> <img src="https://www.plantuml.com/plantuml/svg/RP2n2W8n38RtFaNef4DVG4HEqK5441t58Lx3MRohHrDTvDxTj9wAwD8c-VEL_s_14KEyDhNIPUt8HwtynHBenMe70yyZO69s5syitOOQa87E37S5C72-2Y8EfGvKHlHLBU2MhEEy65ALLm4iHZmYYrvYUI8jm-wRMsDmE9zbiacrFVwmbbfnsuXD_lF2TBFCDBQk9_S2HCDj4Ak79AK-WvrwnWKJN7MAPW9z6jNV7o4pwO2nUROl3ofdUO-ZAiXR-Si7" alt="uml diagram"> <ul><li>Sample App. Repository<br> <a href="https://github.com/htdp1/dept-spring" target="_blank" rel="noopener noreferrer">https://github.com/htdp1/dept-spring<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="개발환경-준비"><a href="#개발환경-준비" class="header-anchor">#</a> 개발환경 준비</h2> <h3 id="redis-설치"><a href="#redis-설치" class="header-anchor">#</a> redis 설치</h3> <ul><li></li></ul> <h3 id="mariadb-설치"><a href="#mariadb-설치" class="header-anchor">#</a> mariadb 설치</h3> <ul><li></li></ul> <h3 id="vs-code-개발환경"><a href="#vs-code-개발환경" class="header-anchor">#</a> vs code 개발환경</h3> <ul><li>vs code 에서 spring-boot 개발 환경을 구축한다.</li> <li>spring-boot stater project 를 생성한다.</li></ul> <h2 id="spring-boot-data-rest-를-이용한-db-table-crud-개발"><a href="#spring-boot-data-rest-를-이용한-db-table-crud-개발" class="header-anchor">#</a> spring-boot-data-rest 를 이용한 DB table CRUD 개발</h2> <p>아래 절차대로 작업을 진행합니다.</p> <ul><li>maven dependency 추가</li> <li>application.yml 설정</li> <li>model class 생성</li> <li>repository class 생성</li> <li>spring-boot 실행 후 API 확인</li></ul> <h3 id="maven-dependency-추가"><a href="#maven-dependency-추가" class="header-anchor">#</a> maven dependency 추가</h3> <ul><li>pom.xml<div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-rest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.data<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-data-rest-webmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul> <h3 id="application-yml-설정"><a href="#application-yml-설정" class="header-anchor">#</a> application.yml 설정</h3> <ul><li>샘플소스는 mariadb 를 사용했으나 개별 사용중인 DB 를 사용하세요.</li> <li>application-mariadb.yml 추가<div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> org.mariadb.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mariadb<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3300/employees<span class="token punctuation">?</span>characterEncoding=UTF<span class="token punctuation">-</span><span class="token number">8</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skcc
</code></pre></div></li> <li>application.yml 설정<div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /dept<span class="token punctuation">-</span>spring

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">import</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> application<span class="token punctuation">-</span>mariadb.yml
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">rest</span><span class="token punctuation">:</span>
      <span class="token key atrule">basePath</span><span class="token punctuation">:</span> /api
  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
    <span class="token key atrule">properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>
        <span class="token key atrule">format_sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">'[com.htdp1.deptspring]'</span><span class="token punctuation">:</span> debug
    <span class="token key atrule">'[org.hibernate.SQL]'</span><span class="token punctuation">:</span> debug
    <span class="token key atrule">'[org.hibernate.type.descriptor.sql.BasicBinder]'</span><span class="token punctuation">:</span> trace
</code></pre></div></li></ul> <h3 id="model-class-생성"><a href="#model-class-생성" class="header-anchor">#</a> model class 생성</h3> <ul><li>table name, field name 에 맞춰서 아래 format 으로 작성합니다.</li> <li>model.Department.java<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Entity</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;departments&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@NoArgsConstructor</span><span class="token punctuation">(</span>access <span class="token operator">=</span> <span class="token class-name">AccessLevel</span><span class="token punctuation">.</span>PROTECTED<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Department</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;dept_no&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> deptNo<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;dept_name&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> deptName<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Builder</span>
    <span class="token keyword">public</span> <span class="token class-name">Department</span><span class="token punctuation">(</span><span class="token class-name">String</span> deptNo<span class="token punctuation">,</span> <span class="token class-name">String</span> deptName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>deptNo <span class="token operator">=</span> deptNo<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>deptName <span class="token operator">=</span> deptName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="repository-class-생성"><a href="#repository-class-생성" class="header-anchor">#</a> repository class 생성</h3> <ul><li>repository.DepartmentRepository.java<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RepositoryRestResource</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DepartmentRepository</span> <span class="token keyword">extends</span> <span class="token class-name">CrudRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Department</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="spring-boot-실행-후-api-확인"><a href="#spring-boot-실행-후-api-확인" class="header-anchor">#</a> spring-boot 실행 후 API 확인</h3> <ul><li>http://localhost:8080/dept-spring/api/<div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;_links&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;departments&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:8080/dept-spring/api/departments&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;profile&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:8080/dept-spring/api/profile&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>http://localhost:8080/dept-spring/api/departments<div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;_embedded&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;departments&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;deptName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Customer Service added&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_links&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;self&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:8080/dept-spring/api/departments/d009&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;department&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:8080/dept-spring/api/departments/d009&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token property">&quot;deptName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Development&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;_links&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;self&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:8080/dept-spring/api/departments/d005&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;department&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:8080/dept-spring/api/departments/d005&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_links&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;self&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:8080/dept-spring/api/departments&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;profile&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:8080/dept-spring/api/profile/departments&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="spring-boot-redis-적용-개발"><a href="#spring-boot-redis-적용-개발" class="header-anchor">#</a> spring-boot redis 적용 개발</h2> <p>아래 작업을 진행합니다.</p> <ul><li>maven dependency 추가</li> <li>application.yml redis 설정</li> <li>redis configuration class 생성</li> <li>repository class 에 cache 적용</li></ul> <h3 id="maven-dependency-추가-2"><a href="#maven-dependency-추가-2" class="header-anchor">#</a> maven dependency 추가</h3> <ul><li>pom.xml<div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul> <h3 id="application-yml-redis-설정"><a href="#application-yml-redis-설정" class="header-anchor">#</a> application.yml redis 설정</h3> <ul><li>application-redis.yml 파일 생성<div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span> 
  <span class="token key atrule">cache</span><span class="token punctuation">:</span> 
    <span class="token key atrule">type</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">redis</span><span class="token punctuation">:</span>
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> <span class="token string">&quot;htdp1:dept-spring:cache:&quot;</span> <span class="token comment"># redis key name prefix</span>
      <span class="token key atrule">ttl</span><span class="token punctuation">:</span> <span class="token number">10</span>                               <span class="token comment"># time to leave (min)</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1                       <span class="token comment"># redis host</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">7001</span>                            <span class="token comment"># redis port</span>
      <span class="token key atrule">password</span><span class="token punctuation">:</span>                             <span class="token comment"># redis password</span>
</code></pre></div></li> <li>application.yml 에 import 처리<div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">import</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> application<span class="token punctuation">-</span>redis.yml
</code></pre></div></li></ul> <h3 id="redis-configuration-class-생성"><a href="#redis-configuration-class-생성" class="header-anchor">#</a> redis configuration class 생성</h3> <ul><li>application.yml 에서 redis 설정 정보를 가져온다.</li> <li>RedisConnectionFactory 로 redis connection 을 생성한다.</li> <li>CacheManager 에 prefix 와 ttl 을 설정한다.</li> <li>config.CacheConfig.java<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableCaching</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CacheConfig</span> <span class="token keyword">extends</span> <span class="token class-name">CachingConfigurerSupport</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${spring.cache.redis.host}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> host<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${spring.cache.redis.port}&quot;</span><span class="token punctuation">)</span> <span class="token keyword">int</span> port<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${spring.cache.redis.namespace}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> namespace<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${spring.cache.redis.ttl}&quot;</span><span class="token punctuation">)</span> <span class="token keyword">long</span> ttl<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;redisCacheConnectionFactory&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisConnectionFactory</span> <span class="token function">redisCacheConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// redis connection cofiguration</span>
        <span class="token class-name">RedisStandaloneConfiguration</span> redisStandaloneConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisStandaloneConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisStandaloneConfiguration<span class="token punctuation">.</span><span class="token function">setHostName</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisStandaloneConfiguration<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// redis connection factory</span>
        <span class="token class-name">LettuceConnectionFactory</span> connectionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LettuceConnectionFactory</span><span class="token punctuation">(</span>redisStandaloneConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> connectionFactory<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;cacheManager&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">CacheManager</span> <span class="token function">cacheManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// redis cache configuration</span>
        <span class="token class-name">RedisCacheConfiguration</span> configuration <span class="token operator">=</span> <span class="token class-name">RedisCacheConfiguration</span>
                <span class="token punctuation">.</span><span class="token function">defaultCacheConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">serializeValuesWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span>
                        <span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">prefixCacheNameWith</span><span class="token punctuation">(</span>namespace<span class="token punctuation">)</span> <span class="token comment">// cache key prefix</span>
                <span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span>ttl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// time-to-live</span>
        <span class="token punctuation">;</span> 

        <span class="token comment">// redis cache manager</span>
        <span class="token class-name">RedisCacheManager<span class="token punctuation">.</span>RedisCacheManagerBuilder</span> builder <span class="token operator">=</span> <span class="token class-name">RedisCacheManager<span class="token punctuation">.</span>RedisCacheManagerBuilder</span>
                <span class="token punctuation">.</span><span class="token function">fromConnectionFactory</span><span class="token punctuation">(</span><span class="token function">redisCacheConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// connection factory</span>
                <span class="token punctuation">.</span><span class="token function">cacheDefaults</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span> <span class="token comment">// redis cache configuration</span>
        <span class="token punctuation">;</span>

        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="repository-class-에-cache-적용"><a href="#repository-class-에-cache-적용" class="header-anchor">#</a> repository class 에 cache 적용</h3> <ul><li>cache 를 적용할 interface 를 @Override 한다.</li> <li>interface 에 @Cacheable 을 추가한다.
<ul><li>cacheNames : cache key name</li> <li>key : cache key</li> <li>cacheManager : CacheConfig.java 의 @Bean(name = &quot;cacheManager&quot;) 과 동일하게 설정한다.</li></ul></li> <li>repository.DepartmentRepository.java<div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RepositoryRestResource</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DepartmentRepository</span> <span class="token keyword">extends</span> <span class="token class-name">CrudRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Department</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token string">&quot;departments&quot;</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">&quot;'findAll'&quot;</span><span class="token punctuation">,</span> cacheManager <span class="token operator">=</span> <span class="token string">&quot;cacheManager&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Department</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>cacheNames <span class="token operator">=</span> <span class="token string">&quot;departments&quot;</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">&quot;#deptNo&quot;</span><span class="token punctuation">,</span> cacheManager <span class="token operator">=</span> <span class="token string">&quot;cacheManager&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Department</span><span class="token punctuation">&gt;</span></span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">String</span> deptNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="redis-에서-데이터-확인"><a href="#redis-에서-데이터-확인" class="header-anchor">#</a> redis 에서 데이터 확인</h3> <ul><li>redis-cli 를 이용하여 redis 에 접속한다.</li> <li>redis 에 저장된 데이터를 확인한다.</li> <li><div class="language- extra-class"><pre class="language-text"><code>127.0.0.1:7001&gt; keys *
1) &quot;htdp1:dept-spring:cache:departments::findAll&quot;
2) &quot;htdp1:dept-spring:cache:departments::d009&quot;
</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/redis/" class="prev router-link-active">
        Introduction
      </a></span> <span class="next"><a href="/redis/perftest.html">
        Redis 성능 측정
      </a>
      →
    </span></p></div> </main></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.aa526b38.js" defer></script><script src="/assets/js/2.a05a4124.js" defer></script><script src="/assets/js/17.b22e9f4c.js" defer></script>
  </body>
</html>
